#!/usr/bin/env bash

npm run react:15
npm run unit -- --coverage
mv coverage/coverage-final.json coverage/coverage-react15.json

npm run react:16
npm run unit -- --coverage
mv coverage/coverage-final.json coverage/coverage-react16.json

mkdir -p .nyc_output
npx istanbul-merge \
  --out .nyc_output/coverage-final.json \
  coverage/coverage-react15.json \
  coverage/coverage-react16.json

rm -rf coverage

npx nyc report --reporter=text-lcov | npx coveralls
npx nyc report --reporter=json-summary

npm run danger

if [ -z "$SAUCE_USERNAME" ] && [ -z "$SAUCE_ACCESS_KEY"]; then
  echo
  echo "ATTENTION"
  echo "Skipping E2E tests because the environment variables are not set!"
else
  npm run e2e:full
fi
